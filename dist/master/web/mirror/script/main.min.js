angular.module("urcMirror",[]).run(function(o){o.safeApply=function(o){var n=this.$root.$$phase;"$apply"==n||"$digest"==n?o&&"function"==typeof o&&o():this.$apply(o)};var n="ws://127.0.0.1:8080/ws",e=new autobahn.Connection({url:n,realm:"realm1"});e.onopen=function(n){o.session=n,o.connection=e,o.$broadcast("connected"),console.log(document.title),n.register("mirror."+n.id,function(){return{id:n.id,module:"web",name:document.title,registrations:_.reduce(n.registrations,function(o,n){return o[n.procedure]=_.pick(n,"id","procedure","active"),o},{}),subscriptions:_.reduce(_.flatten(n.subscriptions),function(o,n){return o[n.topic]=_.pick(n,"id","topic","active"),o},{})}}).then(function(){n.call("mirror",[n.id]).then(function(){n.call("mirror.reflection",[]).then(function(n){console.log(n),o.reflections=n,o.safeApply()})})})},e.open(),$scope.json={test:"test"}}).controller("mainCTRL",function(o){console.log("test"),o.$on("connected",function(){console.log("event received"),o.session.subscribe("mirror.reflection",function(o,n){console.log(n)}).then(function(){console.log("subscribed to topic")},function(o){console.log("failed to subscribe to topic",o)})})});